<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Confetti</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        border: "hsl(214.3 31.8% 91.4%)",
                        background: "hsl(0 0% 100%)",
                        foreground: "hsl(222.2 84% 4.9%)",
                    }
                }
            }
        }
    </script>
    <script>
            // Theme management - must run before page renders
            (function () {
                const theme = localStorage.getItem('theme') || 'system';

                function applyTheme(theme) {
                    if (theme === 'dark' || (theme === 'system' && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                        document.documentElement.classList.add('dark');
                    } else {
                        document.documentElement.classList.remove('dark');
                    }
                }

                applyTheme(theme);

                // Listen for system theme changes
                window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
                    if (localStorage.getItem('theme') === 'system') {
                        applyTheme('system');
                    }
                });
            })();
    </script>
    <style>
        @keyframes buttonAppear {
            0% {
                opacity: 0;
                transform: translateY(20px) scale(0.9);
            }

            60% {
                transform: translateY(-5px) scale(1.05);
            }

            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .button-appear {
            animation: buttonAppear 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }
    </style>
</head>

<body class="bg-white dark:bg-slate-950 text-slate-900 dark:text-slate-100 transition-colors duration-200">
    <!-- Theme Switcher (Vercel Style) -->
    <div class="fixed top-4 right-4 z-50">
        <div
            class="flex items-center gap-1 bg-white dark:bg-slate-950 border border-slate-200 dark:border-slate-800 rounded-full px-1 py-1 shadow-sm dark:shadow-none">
            <button onclick="setTheme('system')" id="theme-system" title="System"
                class="theme-btn p-2 rounded-full transition-all hover:bg-slate-100 dark:hover:bg-slate-800 bg-slate-100 dark:bg-slate-800 text-slate-900 dark:text-slate-100">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
                    <line x1="8" y1="21" x2="16" y2="21"></line>
                    <line x1="12" y1="17" x2="12" y2="21"></line>
                </svg>
            </button>
            <button onclick="setTheme('light')" id="theme-light" title="Light Mode"
                class="theme-btn p-2 rounded-full transition-all hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-600 dark:text-slate-400">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="5"></circle>
                    <line x1="12" y1="1" x2="12" y2="3"></line>
                    <line x1="12" y1="21" x2="12" y2="23"></line>
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                    <line x1="1" y1="12" x2="3" y2="12"></line>
                    <line x1="21" y1="12" x2="23" y2="12"></line>
                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                </svg>
            </button>
            <button onclick="setTheme('dark')" id="theme-dark" title="Dark Mode"
                class="theme-btn p-2 rounded-full transition-all hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-600 dark:text-slate-400">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                </svg>
            </button>
        </div>
    </div>

    <div class="min-h-screen flex items-center justify-center p-8 bg-white dark:bg-slate-950">
        <div class="max-w-3xl w-full">
            <div
                class="rounded-lg border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-950 p-12 shadow-sm dark:shadow-none text-center">
                <h1 id="title"
                    class="text-4xl md:text-6xl font-black tracking-tight mb-4 text-transparent bg-clip-text bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600">
                    Welcome!
                </h1>
                <p id="subtitle" class="text-xl text-slate-600 dark:text-slate-400 leading-7 mb-8">
                    Add ?title=Your Title&subtitle=Your Subtitle to the URL
                </p>
                <button id="confettiButton" onclick="launchButtonConfetti()"
                    class="inline-flex items-center justify-center rounded-md text-sm font-medium transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 bg-slate-900 dark:bg-slate-100 text-white dark:text-slate-900 hover:bg-slate-800 dark:hover:bg-slate-200 h-10 px-6 py-2 shadow-sm hover:shadow-md active:scale-95 transform disabled:opacity-60 disabled:grayscale disabled:cursor-not-allowed disabled:hover:bg-slate-900 dark:disabled:hover:bg-slate-100 disabled:active:scale-100 disabled:brightness-75 opacity-0">
                    ðŸŽ‰ Celebre mais!
                </button>
            </div>
        </div>
    </div>

    <script>
        // Theme management functions
        function setTheme(theme) {
            localStorage.setItem('theme', theme);

            // Update button states
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.classList.remove('bg-slate-100', 'dark:bg-slate-800', 'text-slate-900', 'dark:text-slate-100');
                btn.classList.add('text-slate-600', 'dark:text-slate-400');
            });
            const activeBtn = document.getElementById(`theme-${theme}`);
            activeBtn.classList.remove('text-slate-600', 'dark:text-slate-400');
            activeBtn.classList.add('bg-slate-100', 'dark:bg-slate-800', 'text-slate-900', 'dark:text-slate-100');

            // Apply theme
            if (theme === 'dark' || (theme === 'system' && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        }

        // Initialize theme button states
        const currentTheme = localStorage.getItem('theme') || 'system';
        document.querySelectorAll('.theme-btn').forEach(btn => {
            btn.classList.remove('bg-slate-100', 'dark:bg-slate-800', 'text-slate-900', 'dark:text-slate-100');
            btn.classList.add('text-slate-600', 'dark:text-slate-400');
        });
        const activeBtn = document.getElementById(`theme-${currentTheme}`);
        activeBtn.classList.remove('text-slate-600', 'dark:text-slate-400');
        activeBtn.classList.add('bg-slate-100', 'dark:bg-slate-800', 'text-slate-900', 'dark:text-slate-100');

        // Get URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const title = urlParams.get('title');
        const subtitle = urlParams.get('subtitle');

        // Update content if parameters exist
        if (title) {
            document.getElementById('title').textContent = title;
        }
        if (subtitle) {
            document.getElementById('subtitle').textContent = subtitle;
        }

        // Mobile detection
        const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent) || window.innerWidth < 768;

        // Track active confetti animations
        let activeConfettiCount = 0;
        const MAX_CONFETTI = isMobile ? 10 : 30;
        let cooldownActive = false;

        // Shared canvas for better mobile performance
        let sharedCanvas = null;
        let sharedCtx = null;
        let allParticles = [];

        function updateButtonState() {
            const button = document.getElementById('confettiButton');
            if (cooldownActive) {
                button.disabled = true;
                button.textContent = 'ðŸŽŠ Pera ai! Muito confete';
            } else {
                button.disabled = false;
                button.textContent = 'ðŸŽ‰ Celebre mais!';
            }
        }

        function startCooldown() {
            cooldownActive = true;
            updateButtonState();
            setTimeout(() => {
                cooldownActive = false;
                updateButtonState();
            }, 2000);
        }

        // Initialize shared canvas
        function initSharedCanvas() {
            if (!sharedCanvas) {
                sharedCanvas = document.createElement("canvas");
                sharedCanvas.style.position = "fixed";
                sharedCanvas.style.top = "0";
                sharedCanvas.style.left = "0";
                sharedCanvas.style.width = "100vw";
                sharedCanvas.style.height = "100vh";
                sharedCanvas.style.pointerEvents = "none";
                sharedCanvas.style.zIndex = "9999";
                sharedCanvas.width = window.innerWidth;
                sharedCanvas.height = window.innerHeight;
                document.body.appendChild(sharedCanvas);

                sharedCtx = sharedCanvas.getContext("2d", {
                    alpha: true,
                    desynchronized: true // Better performance on mobile
                });
            }
        }

        // Optimized confetti implementation using shared canvas
        function createConfetti(x, y, angle, spread, colors, onComplete) {
            initSharedCanvas();

            const particleCount = isMobile ? 20 : 40; // Reduce particles on mobile
            const burstParticles = [];

            // Create particles with multiple shapes
            for (let i = 0; i < particleCount; i++) {
                const particleAngle = angle + (Math.random() - 0.5) * spread;
                const velocity = Math.random() * 18 + 21.6;

                const particle = {
                    x: x * window.innerWidth,
                    y: y * window.innerHeight,
                    vx: Math.cos((particleAngle * Math.PI) / 180) * velocity,
                    vy: Math.sin((particleAngle * Math.PI) / 180) * velocity,
                    color: colors[Math.floor(Math.random() * colors.length)],
                    size: Math.random() * 8 + 4,
                    shape: ["square", "circle", "triangle", "rectangle"][
                        Math.floor(Math.random() * 4)
                    ],
                    rotation: Math.random() * 360,
                    rotationSpeed: (Math.random() - 0.5) * 20,
                    gravity: 0.5,
                    life: 1.0,
                    decay: 0.0025,
                    burstId: Date.now() + Math.random() // Unique ID for this burst
                };

                burstParticles.push(particle);
                allParticles.push(particle);
            }

            // Track if this burst is complete
            let burstComplete = false;

            // Main animation loop (runs once for all particles)
            if (allParticles.length === burstParticles.length) {
                requestAnimationFrame(animate);
            }

            // Check periodically if this burst is done
            const checkInterval = setInterval(() => {
                const burstStillActive = burstParticles.some(p =>
                    allParticles.includes(p)
                );

                if (!burstStillActive && !burstComplete) {
                    burstComplete = true;
                    clearInterval(checkInterval);
                    if (onComplete) onComplete();
                }
            }, 100);
        }

        function animate() {
            if (!sharedCtx || allParticles.length === 0) {
                // Clean up canvas when no particles remain
                if (sharedCanvas && allParticles.length === 0) {
                    document.body.removeChild(sharedCanvas);
                    sharedCanvas = null;
                    sharedCtx = null;
                }
                return;
            }

            sharedCtx.clearRect(0, 0, sharedCanvas.width, sharedCanvas.height);

            for (let i = allParticles.length - 1; i >= 0; i--) {
                const p = allParticles[i];

                // Update physics
                p.x += p.vx;
                p.y += p.vy;
                p.vy += p.gravity;
                p.vx *= 0.98;
                p.rotation += p.rotationSpeed;
                p.life -= p.decay;

                // Draw particle based on shape
                sharedCtx.save();
                sharedCtx.translate(p.x, p.y);
                sharedCtx.rotate((p.rotation * Math.PI) / 180);
                sharedCtx.globalAlpha = p.life;
                sharedCtx.fillStyle = p.color;

                if (p.shape === "circle") {
                    sharedCtx.beginPath();
                    sharedCtx.arc(0, 0, p.size / 2, 0, Math.PI * 2);
                    sharedCtx.fill();
                } else if (p.shape === "triangle") {
                    sharedCtx.beginPath();
                    sharedCtx.moveTo(0, -p.size / 2);
                    sharedCtx.lineTo(-p.size / 2, p.size / 2);
                    sharedCtx.lineTo(p.size / 2, p.size / 2);
                    sharedCtx.closePath();
                    sharedCtx.fill();
                } else if (p.shape === "rectangle") {
                    const width = p.size * 1.5;
                    const height = p.size * 0.7;
                    sharedCtx.fillRect(-width / 2, -height / 2, width, height);
                } else {
                    sharedCtx.fillRect(-p.size / 2, -p.size / 2, p.size, p.size);
                }

                sharedCtx.restore();

                // Remove dead particles
                if (p.life <= 0 || p.y > window.innerHeight + 100) {
                    allParticles.splice(i, 1);
                }
            }

            if (allParticles.length > 0) {
                requestAnimationFrame(animate);
            } else {
                // Clean up canvas when done
                if (sharedCanvas) {
                    document.body.removeChild(sharedCanvas);
                    sharedCanvas = null;
                    sharedCtx = null;
                }
            }
        }

        // Launch confetti celebration (initial load - long duration)
        function launchConfetti() {
            // Colorful confetti colors
            const colors = [
                "#22c55e",
                "#16a34a",
                "#15803d",
                "#86efac",
                "#bbf7d0",
                "#dcfce7",
                "#3b82f6",
                "#ef4444",
                "#f59e0b",
                "#8b5cf6",
            ];
            const end = Date.now() + (isMobile ? 400 : 800); // Shorter on mobile
            let burstCount = 0;
            let initialConfettiDone = false;

            function checkShowButton() {
                // Show button only after bursts are done AND all animations finished
                if (initialConfettiDone && activeConfettiCount === 0) {
                    const button = document.getElementById('confettiButton');
                    button.classList.add('button-appear');
                }
            }

            function frame() {
                // Left and right cannons firing
                activeConfettiCount++;
                createConfetti(0, 1, -45, 80, colors, () => {
                    activeConfettiCount--;
                    updateButtonState();
                    checkShowButton();
                });

                activeConfettiCount++;
                createConfetti(1, 1, -135, 80, colors, () => {
                    activeConfettiCount--;
                    updateButtonState();
                    checkShowButton();
                });

                updateButtonState();
                burstCount++;

                if (Date.now() < end) {
                    setTimeout(frame, isMobile ? 120 : 80); // Slower on mobile
                } else {
                    // All bursts have been created
                    initialConfettiDone = true;
                    checkShowButton();
                }
            }

            frame();
        }

        // Launch confetti from button (shorter duration)
        function launchButtonConfetti() {
            if (activeConfettiCount >= MAX_CONFETTI) {
                startCooldown(); // Trigger 3-second cooldown
                return;
            }

            // Colorful confetti colors
            const colors = [
                "#22c55e",
                "#16a34a",
                "#15803d",
                "#86efac",
                "#bbf7d0",
                "#dcfce7",
                "#3b82f6",
                "#ef4444",
                "#f59e0b",
                "#8b5cf6",
            ];
            const end = Date.now() + 50; // 0.05 seconds duration (shorter than initial)

            function frame() {
                // Left and right cannons firing
                activeConfettiCount++;
                createConfetti(0, 1, -45, 80, colors, () => {
                    activeConfettiCount--;
                    updateButtonState();
                });

                activeConfettiCount++;
                createConfetti(1, 1, -135, 80, colors, () => {
                    activeConfettiCount--;
                    updateButtonState();
                });

                updateButtonState();

                if (Date.now() < end) {
                    setTimeout(frame, isMobile ? 120 : 80); // Slower on mobile
                }
            }

            frame();
        }

        // Launch confetti when page loads
        window.addEventListener('load', function () {
            setTimeout(launchConfetti, 100);
        });
    </script>
</body>

</html>